# KE Analyzer - æŠ€æœ¯æ–‡æ¡£æ›´æ–° (v1.1)

**æ›´æ–°æ—¥æœŸ**: 2026-02-03  
**æ›´æ–°å†…å®¹**: æ±‡ç¼–å±‚æ¬¡åˆ†æ + å†…æ ¸æºç åˆ†ææ¥å£

---

## æ›´æ–°å†…å®¹æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸º KE Analyzer å¢åŠ äº†ä¸¤å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š

1. **æ±‡ç¼–å±‚æ¬¡åˆ†æåŠŸèƒ½** - åŸºäºå¯„å­˜å™¨å’Œæ±‡ç¼–æŒ‡ä»¤çš„æ·±åº¦ crash åˆ†æ
2. **å†…æ ¸æºç åˆ†ææ¥å£** - é¢„ç•™çš„ Android Linux å†…æ ¸æºç è”åˆåˆ†ææ¥å£

---

## 1. æ±‡ç¼–å±‚æ¬¡åˆ†æ (Assembly Level Analysis)

### 1.1 åŠŸèƒ½å®šä½

æ±‡ç¼–å±‚æ¬¡åˆ†ææ˜¯è¿æ¥ crash dump å’Œæºä»£ç çš„æ¡¥æ¢ï¼Œé€šè¿‡åˆ†æï¼š
- å¯„å­˜å™¨çŠ¶æ€å˜åŒ–
- æ±‡ç¼–æŒ‡ä»¤åºåˆ—
- å†…å­˜è®¿é—®æ¨¡å¼

å®ç°ä»¥ä¸‹æ£€æµ‹èƒ½åŠ›ï¼š

| æ£€æµ‹ç±»å‹ | è¯†åˆ«å†…å®¹ | å…¸å‹åœºæ™¯ |
|---------|---------|---------|
| **ç©ºæŒ‡é’ˆæ£€æµ‹** | å¯¹ NULL å¯„å­˜å™¨çš„å†…å­˜è®¿é—® | æŒ‡é’ˆæœªåˆå§‹åŒ–æ£€æŸ¥é—æ¼ |
| **ä½ç¿»è½¬æ£€æµ‹** | å•/åŒä½ç¿»è½¬æ¨¡å¼ | ç¡¬ä»¶æ•…éšœã€è¾å°„ã€å†…å­˜é—®é¢˜ |
| **å†…å­˜ç ´å** | è¶Šç•Œè®¿é—®ã€å¼‚å¸¸åç§» | æ•°ç»„è¶Šç•Œã€ç»“æ„ä½“ç ´å |
| **æ ˆç ´å** | æ ˆå¸§å¼‚å¸¸ | æ ˆæº¢å‡ºã€ROP æ”»å‡» |

### 1.2 æ¶æ„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ–°å¢: æ±‡ç¼–åˆ†æå±‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   vmcore_parser â”€â”€â–¶ AssemblyAnalyzer â”€â”€â–¶ Context       â”‚
â”‚        â”‚                  â”‚                  â”‚          â”‚
â”‚        â”‚                  â–¼                  â–¼          â”‚
â”‚        â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       AI Analysis     â”‚
â”‚        â”‚            â”‚Register  â”‚            â”‚          â”‚
â”‚        â”‚            â”‚Tracking  â”‚            â–¼          â”‚
â”‚        â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      Report with     â”‚
â”‚        â”‚            â”‚Instruction    Assembly Insights  â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Analysis  â”‚                        â”‚
â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚                     â”‚Bitflip   â”‚                        â”‚
â”‚                     â”‚Detection â”‚                        â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒç»„ä»¶

#### 1.3.1 AssemblyAnalyzer (`tools/asm_analyzer.py`)

```python
class AssemblyAnalyzer:
    """æ±‡ç¼–å±‚æ¬¡åˆ†æå™¨"""
    
    # ä¸»è¦æ–¹æ³•
    async def analyze_with_registers(
        self, 
        asm_analysis: FunctionAsmAnalysis,
        registers: Dict[str, str],
        crashed_address: Optional[str] = None
    ) -> FunctionAsmAnalysis
    
    async def detect_bitflip(
        self,
        value: int,
        expected_range: Tuple[int, int]
    ) -> Optional[Dict[str, Any]]
```

#### 1.3.2 æ•°æ®ç»“æ„

```python
@dataclass
class AsmInstruction:
    """æ±‡ç¼–æŒ‡ä»¤è§£æ"""
    address: str              # æŒ‡ä»¤åœ°å€
    instruction: str          # æŒ‡ä»¤å (LDR, STR, ADD...)
    operands: str             # æ“ä½œæ•°
    inst_type: InstructionType  # LOAD/STORE/BRANCH...
    memory_access: bool       # æ˜¯å¦å†…å­˜è®¿é—®
    memory_address_reg: str   # åŸºå€å¯„å­˜å™¨
    memory_offset: int        # åç§»é‡
    anomalies: List[Dict]     # æ£€æµ‹åˆ°çš„å¼‚å¸¸

@dataclass
class RegisterState:
    """å¯„å­˜å™¨çŠ¶æ€"""
    name: str
    value: str
    value_int: int
    is_null: bool           # æ˜¯å¦ä¸º NULL
    is_suspicious: bool     # æ˜¯å¦å¯ç–‘
    suspicious_reason: str  # å¯ç–‘åŸå› 
```

#### 1.3.3 å¼‚å¸¸ç±»å‹

```python
class AnomalyType(Enum):
    NULL_POINTER = "null_pointer"
    BITFLIP = "bitflip"
    MEMORY_CORRUPTION = "memory_corruption"
    STACK_CORRUPTION = "stack_corruption"
    USE_AFTER_FREE = "use_after_free"
    OUT_OF_BOUNDS = "out_of_bounds"
    UNINITIALIZED = "uninitialized"
```

### 1.4 åˆ†ææµç¨‹

```
Crash Dump
    â”‚
    â”œâ”€â”€â–¶ 1. æå–å¯„å­˜å™¨çŠ¶æ€ (X0-X30, SP, PC)
    â”‚
    â”œâ”€â”€â–¶ 2. è·å–å´©æºƒç‚¹æ±‡ç¼– (GDB disassemble)
    â”‚        - å´©æºƒæŒ‡ä»¤å‰åå„ 20 æ¡
    â”‚
    â”œâ”€â”€â–¶ 3. è§£ææ¯æ¡æŒ‡ä»¤
    â”‚        - è¯†åˆ«æŒ‡ä»¤ç±»å‹
    â”‚        - æå–è¯»å†™å¯„å­˜å™¨
    â”‚        - è§£æå†…å­˜è®¿é—®æ¨¡å¼
    â”‚
    â”œâ”€â”€â–¶ 4. å¯„å­˜å™¨å€¼åˆ†æ
    â”‚        - NULL æ£€æµ‹
    â”‚        - å¯ç–‘å€¼æ¨¡å¼ (ä½ç¿»è½¬)
    â”‚        - åœ°å€èŒƒå›´éªŒè¯
    â”‚
    â”œâ”€â”€â–¶ 5. æŒ‡ä»¤çº§å¼‚å¸¸æ£€æµ‹
    â”‚        - ç©ºæŒ‡é’ˆè®¿é—®: LDR X0, [X1] where X1=0
    â”‚        - å¼‚å¸¸åç§»: offset > 0x10000
    â”‚        - éå¯¹é½è®¿é—®
    â”‚
    â”œâ”€â”€â–¶ 6. ä½ç¿»è½¬æ£€æµ‹
    â”‚        - å•ä¸€ä½ç¿»è½¬å°è¯•
    â”‚        - åŒä½ç¿»è½¬å°è¯•
    â”‚        - ç¨€ç–ä½æ¨¡å¼è¯†åˆ«
    â”‚
    â””â”€â”€â–¶ 7. ç”Ÿæˆåˆ†ææŠ¥å‘Š
             - å¼‚å¸¸åˆ—è¡¨ (ç±»å‹/ä¸¥é‡çº§åˆ«/æè¿°)
             - å¯„å­˜å™¨çŠ¶æ€æ‘˜è¦
             - ä¿®å¤å»ºè®®
```

### 1.5 é›†æˆç‚¹

#### 1.5.1 vmcore_parser é›†æˆ

```python
# extractor/vmcore_parser.py

async def _perform_assembly_analysis(...):
    """æ‰§è¡Œæ±‡ç¼–å±‚æ¬¡åˆ†æ"""
    
    # 1. è·å–å´©æºƒç‚¹ä¸Šä¸‹æ–‡
    crash_context = await gdb_tool.analyze_crash_point_registers(...)
    
    # 2. åˆ†æè°ƒç”¨æ ˆå‰3å¸§
    for frame in call_stack[:3]:
        func_asm = await gdb_tool.get_function_assembly_with_context(...)
        asm_report = analyze_crash_with_assembly(...)
    
    # 3. æ£€æµ‹ä½ç¿»è½¬
    bitflip_result = self.asm_analyzer.detect_bitflip(x0_value)
```

#### 1.5.2 AI åˆ†æé›†æˆ

```python
# agent/prompt_templates.py

def assembly_level_analysis_prompt(context: Dict) -> str:
    """æ±‡ç¼–å±‚æ¬¡æ·±åº¦åˆ†ææç¤ºè¯"""
    return f"""
    === ASSEMBLY ANALYSIS RESULTS ===
    Crash PC: {context['crash_pc']}
    Anomalies: {context['assembly_analysis']['anomalies']}
    
    === ANALYSIS TASKS ===
    1. Root Cause at Instruction Level
    2. Register State Analysis
    3. Bitflip/Memory Corruption Detection
    4. Memory Access Pattern
    5. Code Path Analysis
    6. Fix Recommendations
    """
```

### 1.6 ä½¿ç”¨ç¤ºä¾‹

```python
from tools.asm_analyzer import analyze_crash_with_assembly

# åˆ†æ crash çš„æ±‡ç¼–å±‚æ¬¡ä¿¡æ¯
report = analyze_crash_with_assembly(
    asm_output=gdb_disassembly_output,
    registers={
        'x0': '0x0000000000000000',
        'x1': '0xFFFFFF80D12F7A80',
        'pc': '0xFFFFFFE91B368DAC',
    },
    crashed_address='0xFFFFFFE91B368DAC',
    function_name='__queue_work'
)

# æŸ¥çœ‹åˆ†æç»“æœ
print(f"å‘ç° {report['suspicious_instruction_count']} æ¡å¯ç–‘æŒ‡ä»¤")
for anomaly in report['anomalies']:
    print(f"[{anomaly['severity']}] {anomaly['type']}")
    print(f"  {anomaly['description']}")
```

### 1.7 è¾“å‡ºç¤ºä¾‹

```json
{
  "function": "__queue_work",
  "instruction_count": 14,
  "suspicious_instruction_count": 9,
  "anomalies": [
    {
      "type": "null_pointer",
      "severity": "CRITICAL",
      "address": "0xffffffe91b368dac",
      "instruction": "ldrb w8, [x1, #258]",
      "description": "ldrb accessing NULL pointer via X1",
      "register": {"name": "X1", "value": "0x0", "is_null": true}
    },
    {
      "type": "bitflip",
      "severity": "HIGH",
      "description": "Suspicious memory access via X9 (Near-null address)"
    }
  ],
  "bitflip_detection": {
    "detected": true,
    "original_value": "0x1",
    "flipped_value": "0x0",
    "bit_position": 0,
    "confidence": "HIGH"
  },
  "recommendations": [
    "Check for missing NULL pointer checks in the code path",
    "Review pointer initialization and validation logic",
    "Consider hardware issues (RAM/ECC errors) or radiation effects"
  ]
}
```

---

## 2. å†…æ ¸æºç åˆ†ææ¥å£ (Kernel Source Interface)

### 2.1 è®¾è®¡ç›®æ ‡

é¢„ç•™ä¸€ä¸ªå¯æ‰©å±•çš„æ¥å£å±‚ï¼Œæœªæ¥æ¥å…¥ Android Linux å†…æ ¸æºç åï¼Œå®ç°ï¼š

- **æºç -æ±‡ç¼–è”åˆåˆ†æ**: å°†æ±‡ç¼–æŒ‡ä»¤æ˜ å°„å›æºä»£ç è¡Œ
- **ç¬¦å·æŸ¥è¯¢**: å¿«é€ŸæŸ¥æ‰¾å‡½æ•°/å˜é‡å®šä¹‰
- **ä»£ç è·¯å¾„åˆ†æ**: é™æ€åˆ†æä»£ç ç»“æ„å’Œè°ƒç”¨å…³ç³»
- **ç»“æ„ä½“å¸ƒå±€**: è·å–ç»“æ„ä½“å†…å­˜å¸ƒå±€ä¿¡æ¯
- **äº¤å‰å¼•ç”¨**: crash ç‚¹ä¸æºç çš„å…³è”åˆ†æ

### 2.2 æ¶æ„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æœªæ¥: å†…æ ¸æºç å±‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚        KernelSourceInterface                 â”‚     â”‚
â”‚   â”‚              (æŠ½è±¡æ¥å£)                       â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚   â”‚  â”‚  lookup  â”‚ â”‚  lookup  â”‚ â”‚  get_    â”‚     â”‚     â”‚
â”‚   â”‚  â”‚  _symbol â”‚ â”‚  _addressâ”‚ â”‚  source  â”‚     â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  _contextâ”‚     â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚   â”‚  â”‚  analyze â”‚ â”‚  cross_reference            â”‚     â”‚
â”‚   â”‚  â”‚  _func   â”‚ â”‚  _crash_point               â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â”‚                               â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â–¼             â–¼             â–¼                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚   Cscope   â”‚ â”‚  Clang   â”‚ â”‚   LSP    â”‚            â”‚
â”‚   â”‚  Backend   â”‚ â”‚  Backend â”‚ â”‚  Backend â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        (ç´¢å¼•)      (é™æ€åˆ†æ)    (è¯­è¨€æœåŠ¡)            â”‚
â”‚                                                         â”‚
â”‚   å½“å‰: KernelSourceAnalyzerStub (æ¡©å®ç°)               â”‚
â”‚        - è®°å½•æ‰€æœ‰è°ƒç”¨è¯·æ±‚                               â”‚
â”‚        - è¿”å›å ä½ç¬¦æ•°æ®                                 â”‚
â”‚        - ä¿æŒæ¥å£å¥‘çº¦                                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ¥å£å®šä¹‰

```python
class KernelSourceInterface(ABC):
    """å†…æ ¸æºç åˆ†ææ¥å£ (æŠ½è±¡åŸºç±»)"""
    
    @abstractmethod
    async def initialize(self, kernel_source_path: str) -> bool:
        """åˆå§‹åŒ–æºç åˆ†æå™¨"""
        pass
    
    @abstractmethod
    async def lookup_symbol(self, symbol_name: str) -> Optional[SymbolInfo]:
        """æŸ¥æ‰¾ç¬¦å·å®šä¹‰"""
        pass
    
    @abstractmethod
    async def lookup_address(
        self, 
        address: str, 
        vmlinux_path: str
    ) -> Optional[SourceLocation]:
        """å°†åœ°å€æ˜ å°„åˆ°æºç ä½ç½®"""
        pass
    
    @abstractmethod
    async def get_source_context(
        self,
        location: SourceLocation,
        context_lines: int = 10
    ) -> Optional[CodeContext]:
        """è·å–æºä»£ç ä¸Šä¸‹æ–‡"""
        pass
    
    @abstractmethod
    async def analyze_function(
        self, 
        function_name: str
    ) -> Optional[FunctionAnalysis]:
        """åˆ†æå‡½æ•°ä»£ç ç»“æ„"""
        pass
    
    @abstractmethod
    async def cross_reference_crash_point(
        self,
        crash_address: str,
        vmlinux_path: str,
        call_stack: List[Dict[str, str]]
    ) -> Dict[str, Any]:
        """äº¤å‰åˆ†æ crash ç‚¹å’Œæºç """
        pass
```

### 2.4 æ•°æ®ç»“æ„

```python
@dataclass
class SourceLocation:
    """æºç ä½ç½®"""
    file_path: str
    line_number: int
    column: Optional[int] = None
    function_name: Optional[str] = None

@dataclass
class SymbolInfo:
    """ç¬¦å·ä¿¡æ¯"""
    name: str
    symbol_type: SymbolType  # FUNCTION/VARIABLE/STRUCT...
    location: SourceLocation
    size: Optional[int] = None
    type_info: Optional[str] = None
    signature: Optional[str] = None  # å‡½æ•°ç­¾å
    references: List[SourceLocation] = field(default_factory=list)

@dataclass
class FunctionAnalysis:
    """å‡½æ•°åˆ†æç»“æœ"""
    function_name: str
    location: SourceLocation
    total_lines: int = 0
    complexity_score: Optional[int] = None
    memory_allocations: List[SourceLocation] = field(default_factory=list)
    memory_deallocations: List[SourceLocation] = field(default_factory=list)
    lock_operations: List[SourceLocation] = field(default_factory=list)
    null_checks: List[SourceLocation] = field(default_factory=list)
    calls_functions: List[str] = field(default_factory=list)
```

### 2.5 å½“å‰å®ç° (Stub)

å½“å‰æä¾› `KernelSourceAnalyzerStub` æ¡©å®ç°ï¼š

```python
class KernelSourceAnalyzerStub(KernelSourceInterface):
    """æ¡©å®ç° - è®°å½•è°ƒç”¨ï¼Œè¿”å›å ä½ç¬¦"""
    
    async def initialize(self, kernel_source_path: str) -> bool:
        # è®°å½•è°ƒç”¨ï¼Œè¿”å›æˆåŠŸçŠ¶æ€
        self._log_call("initialize", {...})
        return True
    
    async def lookup_symbol(self, symbol_name: str):
        # è¿”å›å ä½ç¬¦æ•°æ®
        return SymbolInfo(
            name=symbol_name,
            location=SourceLocation(
                file_path="/path/to/kernel/kernel/workqueue.c",
                line_number=1437
            )
        )
```

### 2.6 æœªæ¥æ‰©å±•

è®¡åˆ’æ”¯æŒçš„åç«¯å®ç°ï¼š

| åç«¯ | æŠ€æœ¯æ–¹æ¡ˆ | ç‰¹ç‚¹ |
|-----|---------|------|
| **Cscope** | åŸºäº cscope ç´¢å¼• | è½»é‡ã€å¿«é€Ÿã€æˆç†Ÿ |
| **Clang** | libclang é™æ€åˆ†æ | ç²¾ç¡®ã€æ”¯æŒå¤æ‚åˆ†æ |
| **LSP** | Language Server Protocol | é€šç”¨ã€IDE å…¼å®¹ |
| **Database** | SQLite/PostgreSQL ç´¢å¼• | é«˜æ€§èƒ½ã€å¯æ‰©å±• |

### 2.7 é…ç½®ç®¡ç†

```python
class SourceAnalyzerConfig:
    """æºç åˆ†æå™¨é…ç½®"""
    
    kernel_source_path: Optional[str] = None
    index_database_path: Optional[str] = None
    backend_type: str = "stub"  # future: "cscope", "clang", "lsp"
    enable_cache: bool = True
```

ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
# .env
KERNEL_SOURCE_PATH=/path/to/android/kernel
KERNEL_INDEX_DB_PATH=/data/kernel_index.db
SOURCE_ANALYZER_BACKEND=stub  # future: cscope, clang, lsp
```

### 2.8 ä½¿ç”¨ç¤ºä¾‹

```python
from tools.source_analyzer import get_source_analyzer

# è·å–æºç åˆ†æå™¨å®ä¾‹
analyzer = await get_source_analyzer()

# æŸ¥æ‰¾ç¬¦å·å®šä¹‰
symbol = await analyzer.lookup_symbol("__queue_work")
print(f"{symbol.name} at {symbol.location}")

# å°†åœ°å€æ˜ å°„åˆ°æºç 
location = await analyzer.lookup_address(
    "0xffffffe91b368dac",
    "/path/to/vmlinux"
)
print(f"Crash at: {location.file_path}:{location.line_number}")

# è·å–æºç ä¸Šä¸‹æ–‡
context = await analyzer.get_source_context(location, context_lines=10)
print(context.to_string())

# äº¤å‰åˆ†æ crash
cross_ref = await analyzer.cross_reference_crash_point(
    crash_address="0xffffffe91b368dac",
    vmlinux_path="/path/to/vmlinux",
    call_stack=[...]
)
print(cross_ref['relevant_variables'])
```

### 2.9 é›†æˆè§„åˆ’

#### Phase 1: æ¥å£é¢„ç•™ (å½“å‰)
- âœ… å®šä¹‰æŠ½è±¡æ¥å£
- âœ… å®ç°æ¡©ç‰ˆæœ¬
- âœ… é›†æˆåˆ°é…ç½®ç³»ç»Ÿ

#### Phase 2: Cscope åç«¯
- åŸºäº cscope ç´¢å¼•å®ç°
- ç¬¦å·æŸ¥æ‰¾å’Œåœ°å€æ˜ å°„
- åŸºç¡€äº¤å‰å¼•ç”¨

#### Phase 3: Clang åç«¯
- åŸºäº libclang å®ç°
- ç²¾ç¡®çš„ AST åˆ†æ
- å¤æ‚ä»£ç è·¯å¾„åˆ†æ

#### Phase 4: è”åˆåˆ†æ
- æºç  + æ±‡ç¼– + AI è”åˆåˆ†æ
- å˜é‡ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ª
- æ™ºèƒ½ä¿®å¤å»ºè®®

---

## 3. æ›´æ–°åçš„ç³»ç»Ÿæ¶æ„

### 3.1 å®Œæ•´æ¶æ„å›¾ (v1.1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å¤–éƒ¨ç³»ç»Ÿ                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Jira   â”‚  â”‚ Qwen-Max â”‚  â”‚ crash/   â”‚  â”‚  Memory  â”‚  â”‚  Kernel  â”‚   â”‚
â”‚  â”‚  Server  â”‚  â”‚   API    â”‚  â”‚   gdb    â”‚  â”‚   MCP    â”‚  â”‚  Source  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚             â”‚             â”‚             â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Orchestrator å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   main.py   â”‚  â”‚state_managerâ”‚  â”‚         jira_handler.py         â”‚  â”‚
â”‚  â”‚ FastAPIå…¥å£  â”‚  â”‚   çŠ¶æ€ç®¡ç†   â”‚  â”‚         Webhookå¤„ç†             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         Pipeline                                  â”‚   â”‚
â”‚  â”‚  1. ä¸‹è½½é™„ä»¶ â†’ 2. ä¿¡æ¯æå– â†’ 3. æ·±åº¦åˆ†æ â†’ 4. AIåˆ†æ â†’ 5. æ›´æ–°Jira â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Extractor å±‚ (ä¿¡æ¯æå–)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚vmcore_parserâ”‚  â”‚ log_parser  â”‚  â”‚        context_builder          â”‚  â”‚
â”‚  â”‚ +asmåˆ†æ    â”‚  â”‚ kernel log  â”‚  â”‚     +æ±‡ç¼–ä¸Šä¸‹æ–‡ +æºç æ¥å£        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Tools å±‚ (å·¥å…·ç½‘å…³)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ crash_tool â”‚ â”‚  gdb_tool  â”‚ â”‚ addr2line  â”‚ â”‚   asm_analyzer       â”‚ â”‚
â”‚  â”‚ crashå‘½ä»¤  â”‚ â”‚ gdbè°ƒè¯•å°è£… â”‚ â”‚ åœ°å€è½¬æ¢   â”‚ â”‚   æ±‡ç¼–å±‚æ¬¡åˆ†æ       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              source_analyzer (KernelSourceInterface)              â”‚ â”‚
â”‚  â”‚                 å†…æ ¸æºç åˆ†ææ¥å£ (é¢„ç•™)                            â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚   â”‚   lookup    â”‚   â”‚    cross    â”‚   â”‚   get_source_context â”‚   â”‚ â”‚
â”‚  â”‚   â”‚   _symbol   â”‚   â”‚  _reference â”‚   â”‚                      â”‚   â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Agent å±‚ (AIåˆ†æ)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         analyzer.py                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚Basic Analysisâ”‚  â”‚Assembly Levelâ”‚  â”‚Source-Aware Analysis â”‚   â”‚    â”‚
â”‚  â”‚  â”‚   (åŸæœ‰)     â”‚  â”‚   Analysis   â”‚  â”‚     (é¢„ç•™)           â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    prompt_templates.py                          â”‚    â”‚
â”‚  â”‚  â€¢ crash_analysis_system_prompt        (ç³»ç»Ÿæç¤ºè¯)             â”‚    â”‚
â”‚  â”‚  â€¢ assembly_level_analysis_prompt      (æ±‡ç¼–åˆ†æ)    [æ–°å¢]      â”‚    â”‚
â”‚  â”‚  â€¢ memory_corruption_analysis_prompt   (å†…å­˜ç ´å)    [æ–°å¢]      â”‚    â”‚
â”‚  â”‚  â€¢ source_aware_analysis_prompt        (æºç æ„ŸçŸ¥)    [é¢„ç•™]      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Integration å±‚ (é›†æˆå±‚)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ jira/client  â”‚  â”‚              mcp/memory_client                    â”‚ â”‚
â”‚  â”‚  Jira API    â”‚  â”‚  Memory MCP + Assembly Context + Source Context  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–°å¢æ¨¡å—æ¸…å•

| æ¨¡å— | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| æ±‡ç¼–åˆ†æå™¨ | `tools/asm_analyzer.py` | æ±‡ç¼–å±‚æ¬¡åˆ†ææ ¸å¿ƒ |
| æºç åˆ†ææ¥å£ | `tools/source_analyzer.py` | å†…æ ¸æºç åˆ†ææ¥å£ |
| æ±‡ç¼–åˆ†ææ–‡æ¡£ | `docs/ASSEMBLY_ANALYSIS.md` | æ±‡ç¼–åŠŸèƒ½è¯¦ç»†æ–‡æ¡£ |
| æ¼”ç¤ºè„šæœ¬ | `examples/asm_analysis_demo.py` | æ±‡ç¼–åˆ†ææ¼”ç¤º |

### 3.3 ä¿®æ”¹çš„æ¨¡å—æ¸…å•

| æ¨¡å— | å˜æ›´å†…å®¹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| `tools/gdb_tool.py` | æ–°å¢ 3 ä¸ªæ–¹æ³• | +150 |
| `tools/__init__.py` | å¯¼å‡ºæ–°æ¨¡å— | +30 |
| `extractor/vmcore_parser.py` | é›†æˆæ±‡ç¼–åˆ†æ | +120 |
| `extractor/context_builder.py` | æ–°å¢æ±‡ç¼–ä¸Šä¸‹æ–‡ | +80 |
| `agent/prompt_templates.py` | æ–°å¢ 2 ä¸ªæ¨¡æ¿ | +100 |
| `agent/analyzer.py` | é›†æˆæ±‡ç¼–åˆ†æ | +30 |
| `orchestrator/config.py` | æ–°å¢æºç é…ç½®é¡¹ | +20 |

---

## 4. é…ç½®æ›´æ–°

### 4.1 æ–°å¢ç¯å¢ƒå˜é‡

```bash
# === æ±‡ç¼–åˆ†æé…ç½® ===
ENABLE_ASSEMBLY_ANALYSIS=true
MAX_ASM_CONTEXT_INSTRUCTIONS=30
BITFLIP_DETECTION_ENABLED=true

# === å†…æ ¸æºç åˆ†æé…ç½® (é¢„ç•™) ===
KERNEL_SOURCE_PATH=/path/to/android/kernel
KERNEL_INDEX_DB_PATH=/data/kernel_index.db
SOURCE_ANALYZER_BACKEND=stub  # future: cscope, clang, lsp
ENABLE_SOURCE_CACHE=true
SOURCE_CACHE_TTL=3600
```

### 4.2 é…ç½®ç±»æ›´æ–°

```python
# orchestrator/config.py

class Settings(BaseSettings):
    # ... åŸæœ‰é…ç½® ...
    
    # Assembly Analysis Settings
    ENABLE_ASSEMBLY_ANALYSIS: bool = True
    MAX_ASM_CONTEXT_INSTRUCTIONS: int = 30
    BITFLIP_DETECTION_ENABLED: bool = True
    
    # Kernel Source Analysis Settings (é¢„ç•™)
    KERNEL_SOURCE_PATH: Optional[str] = None
    KERNEL_INDEX_DB_PATH: Optional[str] = None
    SOURCE_ANALYZER_BACKEND: str = "stub"
    ENABLE_SOURCE_CACHE: bool = True
    SOURCE_CACHE_TTL: int = 3600
```

---

## 5. API æ›´æ–°

### 5.1 æ–°å¢ç«¯ç‚¹

```python
# è·å–æ±‡ç¼–åˆ†ææŠ¥å‘Š
@app.get("/analysis/{task_id}/assembly")
async def get_assembly_analysis(task_id: str)

# è·å–æºç åˆ†æ (é¢„ç•™)
@app.get("/analysis/{task_id}/source")
async def get_source_analysis(task_id: str)
```

### 5.2 å“åº”æ ¼å¼æ›´æ–°

```json
{
  "task_id": "PROJ-123",
  "status": "completed",
  "crash_analysis": {...},
  "assembly_analysis": {
    "performed": true,
    "crash_pc": "0xFFFFFFE91B368DAC",
    "anomaly_count": 9,
    "anomalies": [...],
    "bitflip_detected": true,
    "recommendations": [...]
  },
  "source_analysis": {
    "status": "not_available",
    "reason": "Kernel source not configured (stub implementation)"
  }
}
```

---

## 6. æœªæ¥æ‰©å±•è·¯çº¿å›¾

### Phase 1: å®Œå–„æ±‡ç¼–åˆ†æ (å½“å‰ - v1.1)
- âœ… åŸºç¡€æ±‡ç¼–è§£æ
- âœ… å¯„å­˜å™¨è·Ÿè¸ª
- âœ… ä½ç¿»è½¬æ£€æµ‹
- ğŸ”„ æ›´å¤šæ¶æ„æ”¯æŒ (x86/x86_64)

### Phase 2: æºç æ¥å…¥ (v1.2)
- Cscope åç«¯å®ç°
- åœ°å€-æºç æ˜ å°„
- åŸºç¡€äº¤å‰å¼•ç”¨

### Phase 3: æ·±åº¦åˆ†æ (v1.3)
- Clang é™æ€åˆ†æåç«¯
- ä»£ç è·¯å¾„åˆ†æ
- å˜é‡ç”Ÿå‘½å‘¨æœŸè·Ÿè¸ª

### Phase 4: æ™ºèƒ½è”åˆåˆ†æ (v1.4)
- æºç  + æ±‡ç¼– + AI è”åˆæ¨ç†
- è‡ªåŠ¨ä¿®å¤å»ºè®®ç”Ÿæˆ
- å†å²å›å½’æ£€æµ‹

---

## é™„å½•

### A. æ¥å£å¥‘çº¦ç¤ºä¾‹

```python
# æ±‡ç¼–åˆ†ææ¥å£å¥‘çº¦
def analyze_crash_with_assembly(
    asm_output: str,           # GDB/crash æ±‡ç¼–è¾“å‡º
    registers: Dict[str, str],  # å¯„å­˜å™¨å€¼
    crashed_address: str,       # å´©æºƒåœ°å€
    function_name: str          # å‡½æ•°å
) -> Dict[str, Any]:
    """
    Returns:
        {
            "function": str,
            "instruction_count": int,
            "suspicious_instruction_count": int,
            "anomalies": List[Anomaly],
            "key_findings": List[str],
            "recommendations": List[str]
        }
    """

# æºç åˆ†ææ¥å£å¥‘çº¦
async def lookup_address(
    address: str,         # åå…­è¿›åˆ¶åœ°å€
    vmlinux_path: str     # vmlinux è·¯å¾„
) -> Optional[SourceLocation]:
    """
    Returns:
        SourceLocation(
            file_path="kernel/workqueue.c",
            line_number=1437,
            function_name="__queue_work"
        )
    """
```

### B. å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2026-02-03 | åˆå§‹ç‰ˆæœ¬ |
| 1.1 | 2026-02-03 | + æ±‡ç¼–å±‚æ¬¡åˆ†æ<br>+ å†…æ ¸æºç åˆ†ææ¥å£ |

---

*æ–‡æ¡£ç»“æŸ*
